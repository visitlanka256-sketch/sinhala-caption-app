<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel | Sinhala Caption App</title>

  <!-- Styles -->
  <link rel="stylesheet" href="css/admin.css" />
  <link rel="icon" href="icons/icon-192x192.png">

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import {
      getDatabase,
      ref,
      push,
      onValue,
      remove,
      update
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

    /* ðŸ”¥ FIREBASE CONFIG (replace with yours) */
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "XXXX",
      appId: "XXXX"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    /* ---------- AUTH ---------- */
    window.login = () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      signInWithEmailAndPassword(auth, email, password)
        .then(() => {
          document.getElementById("login").style.display = "none";
          document.getElementById("panel").style.display = "block";
        })
        .catch(() => alert("âŒ Login failed"));
    };

    window.logout = () => {
      signOut(auth).then(() => location.reload());
    };

    onAuthStateChanged(auth, user => {
      if (user) {
        document.getElementById("login").style.display = "none";
        document.getElementById("panel").style.display = "block";
        loadCaptions();
      }
    });

    /* ---------- CAPTIONS ---------- */
    const captionsRef = ref(db, "captions");

    window.addCaption = () => {
      const text = captionText.value.trim();
      const category = captionCategory.value;

      if (!text) return;

      push(captionsRef, {
        text,
        category,
        time: Date.now()
      });

      captionText.value = "";
    };

    function loadCaptions() {
      onValue(captionsRef, snap => {
        const box = document.getElementById("captionList");
        box.innerHTML = "";

        snap.forEach(child => {
          const id = child.key;
          const data = child.val();

          box.innerHTML += `
            <div class="cap-card">
              <p>${data.text}</p>
              <small>${data.category}</small>
              <div class="actions">
                <button onclick="deleteCaption('${id}')">ðŸ—‘</button>
              </div>
            </div>
          `;
        });
      });
    }

    window.deleteCaption = id => {
      if (confirm("Delete caption?")) {
        remove(ref(db, "captions/" + id));
      }
    };
  </script>
</head>

<body>

<!-- ðŸ” LOGIN -->
<div id="login" class="login-box">
  <h2>Admin Login</h2>
  <input id="email" type="email" placeholder="Admin Email" />
  <input id="password" type="password" placeholder="Password" />
  <button onclick="login()">Login</button>
</div>

<!-- ðŸ›  ADMIN PANEL -->
<div id="panel" class="admin-panel" style="display:none;">
  <header>
    <h1>Admin Panel</h1>
    <button onclick="logout()">Logout</button>
  </header>

  <section class="add-box">
    <textarea id="captionText" placeholder="à·ƒà·’à¶‚à·„à¶½ à¶šà·à¶´à·Šà·‚à¶±à·Š à¶‘à¶š..."></textarea>
    <select id="captionCategory">
      <option value="love">à¶†à¶¯à¶»à¶º</option>
      <option value="sad">à¶¯à·”à¶š</option>
      <option value="funny">à·€à·’à·„à·’à·…à·”</option>
      <option value="motivation">Motivation</option>
      <option value="attitude">Attitude</option>
    </select>
    <button onclick="addCaption()">âž• Add Caption</button>
  </section>

  <section id="captionList" class="caption-list"></section>
</div>

</body>
</html>
